document.addEventListener('DOMContentLoaded', function() {
    const textArea = document.getElementById('text');
    const charCount = document.getElementById('charCount');
    const wordCount = document.getElementById('wordCount');
    const form = document.getElementById('summarizerForm');
    
    function updateCounts() {
        const text = textArea.value;
        const chars = text.length;
        const words = text.trim() ? text.trim().split(/\s+/).length : 0;
        
        charCount.textContent = chars.toLocaleString();
        wordCount.textContent = words.toLocaleString();
        
        if (chars < 100) {
            charCount.className = 'text-danger';
        } else if (chars < 500) {
            charCount.className = 'text-warning';
        } else {
            charCount.className = 'text-success';
        }
    }
    
    if (textArea) {
        textArea.addEventListener('input', updateCounts);
        textArea.addEventListener('paste', function() {
            setTimeout(updateCounts, 10);
        });
    }
    
    if (form) {
        form.addEventListener('submit', function(e) {
            const text = textArea.value.trim();
            if (text.length < 50) {
                e.preventDefault();
                alert('Please enter at least 50 characters for better summarization results.');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
            submitBtn.disabled = true;
            
            form.classList.add('loading');
        });
    }
    
    updateCounts();
});

function clearText() {
    const textArea = document.getElementById('text');
    textArea.value = '';
    textArea.focus();
    
    const event = new Event('input');
    textArea.dispatchEvent(event);
}

function loadSample() {
    const sampleText = `Artificial intelligence (AI) is intelligence demonstrated by machines, in contrast to the natural intelligence displayed by humans and animals. Leading AI textbooks define the field as the study of "intelligent agents": any device that perceives its environment and takes actions that maximize its chance of successfully achieving its goals. Colloquially, the term "artificial intelligence" is often used to describe machines that mimic "cognitive" functions that humans associate with the human mind, such as "learning" and "problem solving".

The scope of AI is disputed: as machines become increasingly capable, tasks considered to require "intelligence" are often removed from the definition of AI, a phenomenon known as the AI effect. A quip in Tesler's Theorem says "AI is whatever hasn't been done yet." For instance, optical character recognition is frequently excluded from things considered to be AI, having become a routine technology. Modern machine learning techniques are effective at many tasks, including computer vision, speech recognition, email filtering, machine translation, and playing board games and video games.

AI applications include advanced web search engines, recommendation systems, understanding human speech, self-driving cars, and competing at the highest level in strategic game systems. As machines become increasingly capable, mental facilities once thought to require intelligence are removed from the definition. Under this definition, AI now encompasses all kinds of computer programs that exhibit intelligent behavior.`;
    
    const textArea = document.getElementById('text');
    textArea.value = sampleText;
    textArea.focus();
    
    const event = new Event('input');
    textArea.dispatchEvent(event);
}

function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.textContent;
    
    navigator.clipboard.writeText(text).then(function() {
        showToast('Text copied to clipboard!', 'success');
    }, function(err) {
        console.error('Could not copy text: ', err);
        showToast('Failed to copy text', 'error');
    });
}

function downloadSummary() {
    const summary = document.getElementById('summaryText').textContent;
    const stats = document.getElementById('summaryStats').textContent;
    const timestamp = new Date().toLocaleString();
    
    const content = `AI Text Summarizer - Summary Report
Generated on: ${timestamp}

SUMMARY:
${summary}

STATISTICS:
${stats}

---
Generated by AI Text Summarizer
`;
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `summary_${new Date().toISOString().slice(0, 10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showToast('Summary downloaded!', 'success');
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'success' ? 'success' : 'danger'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

class SummarizerAPI {
    static async summarize(text, summaryLength = 3) {
        try {
            const response = await fetch('/api/summarize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: text,
                    summary_length: summaryLength
                })
            });
            
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }
}

window.SummarizerAPI = SummarizerAPI;
